<!-- templates/add_recurring_expense.html -->
{% extends "base.html" %}

{% block title %}Add Recurring Expense - Expense Tracker{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-800 py-12 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold text-white">Add Recurring Expense</h1>
            <p class="mt-4 text-lg text-gray-300">Set up automatic expense tracking</p>
        </div>
        
        <div class="bg-gray-700 shadow-lg rounded-xl p-8 border border-gray-600">
            <form method="POST">
                {{ form.hidden_tag() }}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        {{ form.title.label(class="block text-sm font-medium text-gray-200 mb-2") }}
                        {{ form.title(class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-lime-400 focus:border-transparent") }}
                        {% for error in form.title.errors %}
                            <p class="text-red-400 text-sm mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    <div>
                        {{ form.amount.label(class="block text-sm font-medium text-gray-200 mb-2") }}
                        <div class="relative">
                            <span class="absolute left-3 top-3 text-gray-400">₹</span>
                            {{ form.amount(class="w-full pl-8 pr-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-lime-400 focus:border-transparent") }}
                        </div>
                        {% for error in form.amount.errors %}
                            <p class="text-red-400 text-sm mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        {{ form.category_id.label(class="block text-sm font-medium text-gray-200 mb-2") }}
                        {{ form.category_id(class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-lime-400 focus:border-transparent") }}
                        {% for error in form.category_id.errors %}
                            <p class="text-red-400 text-sm mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                    <div>
                        {{ form.frequency.label(class="block text-sm font-medium text-gray-200 mb-2") }}
                        {{ form.frequency(class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-lime-400 focus:border-transparent") }}
                        {% for error in form.frequency.errors %}
                            <p class="text-red-400 text-sm mt-1">{{ error }}</p>
                        {% endfor %}
                    </div>
                </div>

                <div class="mb-6">
                    {{ form.description.label(class="block text-sm font-medium text-gray-200 mb-2") }}
                    {{ form.description(class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-lime-400 focus:border-transparent", rows="3", placeholder="Optional description...") }}
                    {% for error in form.description.errors %}
                        <p class="text-red-400 text-sm mt-1">{{ error }}</p>
                    {% endfor %}
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        {{ form.start_date.label(class="block text-sm font-medium text-gray-200 mb-2") }}
                        {{ form.start_date(class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-lime-400 focus:border-transparent") }}
                        {% for error in form.start_date.errors %}
                            <p class="text-red-400 text-sm mt-1">{{ error }}</p>
                        {% endfor %}
                        <p class="text-gray-400 text-sm mt-1">When should this recurring expense start?</p>
                    </div>
                    <div>
                        {{ form.end_date.label(class="block text-sm font-medium text-gray-200 mb-2") }}
                        {{ form.end_date(class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-lime-400 focus:border-transparent") }}
                        {% for error in form.end_date.errors %}
                            <p class="text-red-400 text-sm mt-1">{{ error }}</p>
                        {% endfor %}
                        <p class="text-gray-400 text-sm mt-1">Leave blank for indefinite recurring</p>
                    </div>
                </div>

                <div class="bg-blue-500 bg-opacity-20 border border-blue-500 text-blue-200 px-6 py-4 rounded-lg mb-8">
                    <div class="flex items-start">
                        <svg class="w-6 h-6 mr-3 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div>
                            <p class="font-semibold mb-1">How it works:</p>
                            <p class="text-sm">Your recurring expense will be available for processing starting from the start date. You can manually process due expenses or set up automatic processing.</p>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 justify-between">
                    <a href="{{ url_for('main.recurring_expenses') }}" class="bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-500 transition duration-200 text-center">
                        <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Cancel
                    </a>
                    {{ form.submit(class="bg-lime-400 text-gray-900 px-6 py-3 rounded-lg font-semibold hover:bg-lime-500 transition duration-200") }}
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Auto-generate title based on category and amount
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.getElementById('category_id');
    const amountInput = document.getElementById('amount');
    const titleInput = document.getElementById('title');
    
    function generateTitle() {
        if (titleInput.value.trim() === '' && categorySelect.value && amountInput.value) {
            const categoryName = categorySelect.options[categorySelect.selectedIndex].text;
            const amount = parseFloat(amountInput.value).toFixed(2);
            titleInput.value = `${categoryName} - ₹${amount}`;
        }
    }
    
    categorySelect.addEventListener('change', generateTitle);
    amountInput.addEventListener('blur', generateTitle);
});
</script>
{% endblock %}